## 部署 ##

所有 JavaScript 解决方案最重要的部分，便是最后部署到运营中的网站或者是 Web 应用的过程。

### 构建过程

由于 JavaScript 并非一个编译型语言，所写的代码就是要在浏览器中测试的代码。这个方法的问题在于它不是最优的，所写的代码不应该原封不动地放入浏览器中，理由如下：

* 知识产权问题

	如果把带有完整注释的代码放到线上，那别人就更容易知道你的意图，对它再利用，并且可能找到安全漏洞。
 
* 文件大小
	
	书写代码要保证容易阅读，才能更好地维护，但是这对于性能是不利的。浏览器并不能从额外的空白字符或者是冗长的函数名和变量名中获得什么好处。 

* 代码组织

	组织代码要考虑到可维护性并不一定是传送给浏览器的最好方式。

基于这些原因，最好给 JavaScript 文件定义一个构建过程。最好避免使用一个文件存放所有的 JavaScript，遵循以下面向对象语言中的典型模式：将每个对象或自定义类型分别放入其单独的文件中。这样可以确保每个文件包含最少量的代码，使其在不引入错误的情况下更容易修改。另外，在使用像 SVN  这类并发源控制系统的时候，这样做也减少了在合并操作中产生冲突的风险。

将代码分离成多个文件只是为了提高可维护性，并非为了部署。要进行部署的时候，需要将这些源代码合并为一个或几个归并文件。推荐 Web 应用中尽可能使用最少的 JavaScript 文件，是因为 HTTP 请求是 Web 中的主要性能瓶颈之一。通过 `<script>` 标记引用 JavaScript 文件是一个阻塞操作，当代码下载并运行的时候会停止其他所有的下载。因此，尽量从逻辑上将 JavaScript 代码分组成部署文件。

一旦组织好文件和目录结构，并确定哪些要出现在部署文件中，就可以创建构建系统了。构建系统应该可以很方便地获得目录中的所有文件的列表，然后将其合并为一个文件。

### 压缩

当谈及 JavaScript 文件压缩，其实在讨论两个东西：代码长度和配重（Wire weight）。代码长度指的
是浏览器所需解析的字节数，配重指的是实际从服务器传送到浏览器的字节数。

#### 文件压缩

因为 JavaScript 并非编译为字节码，而是按照源代码传送的，代码文件通常包含浏览器执行所不需要的额外的信息和格式。注释，额外的空白，以及长长的变量名和函数名虽然提高了可读性，但却是传送给浏览器时不必要的字节。不过，可以使用压缩工具减少文件的大小。

压缩工具一般进行如下一些步骤：

* 删除额外的空白（包括换行）
* 删除所有注释
* 缩短变量名

所有的 JavaScript 文件在部署到生产环境之前，都应该使用压缩工具进行压缩。给构建过程添加一个压缩 JavaScript 文件的环节以确保每次都进行这个操作。

#### HTTP 压缩

配重指的是实际从服务器传送到浏览器的字节数。因为现在的服务器和浏览器都有压缩功能，这个字节数不一定和代码长度一样。所有的五大 Web 浏览器（IE、 Firefox、 Safari、 Chrome 和 Opera）都支
持对所接收的资源进行客户端解压缩。这样服务器端就可以使用服务器端相关功能来压缩 JavaScript 文
件。一个指定了文件使用了给定格式进行了压缩的 HTTP 头包含在了服务器响应中，接着浏览器会查看该 HTTP 头确定文件是否已被压缩，然后使用合适的格式进行解压缩。结果是和原来的代码量相比在网络中传递的字节数量大大减少了。

大部分 Web 服务器，开源的或是商业的，都有一些 HTTP 压缩功能。可以查看服务器的文档说明以确定如何合适地配置压缩。